{
  "name": "wrongmath-mcp",
  "version": "1.0.1",
  "displayName": "WrongMath 数学错题 OCR",
  "description": "纯本地 Python MCP 服务器，使用 DeepSeek-OCR 识别数学错题，支持 PDF/图片转 Markdown + LaTeX。包含 Web UI 界面（Next.js + FastAPI）。",
  "author": "Gubin",
  "category": "Local Tools",
  "tags": ["ocr", "math", "mcp", "deepseek", "latex", "web-ui", "fastapi", "nextjs"],

  "tools": [
    {
      "name": "read_math_file",
      "description": "读取本地数学题目文件（PDF/图片），利用 DeepSeek-OCR 转换为 Markdown + LaTeX 格式。支持识别复杂公式、几何图形和函数表达式。",
      "inputSchema": {
        "type": "object",
        "properties": {
          "file_path": {
            "type": "string",
            "description": "本地文件的绝对路径 (例如: /Users/gubin/Desktop/test.pdf)"
          }
        },
        "required": ["file_path"]
      }
    },
    {
      "name": "recognize_image",
      "description": "识别图片中的数学公式和文字，自动清除题号前缀，保存为 Markdown 文件。",
      "inputSchema": {
        "type": "object",
        "properties": {
          "image_path": {
            "type": "string",
            "description": "图片文件的绝对路径 (例如: /Users/gubin/Desktop/math.png)"
          },
          "output_path": {
            "type": "string",
            "description": "可选，输出 Markdown 文件的绝对路径。默认保存为 {image_path}.md"
          }
        },
        "required": ["image_path"]
      }
    }
  ],

  "webUI": {
    "description": "Next.js 前端 + FastAPI 后端的 Web 界面，支持拖拽上传、实时进度、历史管理。",
    "frontend": {
      "port": 3000,
      "framework": "Next.js 14.2.0",
      "styling": "Tailwind CSS 3.4.3",
      "components": [
        "FileUpload.jsx - 拖拽上传（react-dropzone）",
        "OCRControl.jsx - OCR 控制面板",
        "ResultPreview.jsx - 结果预览",
        "HistoryList.jsx - 历史记录"
      ],
      "features": [
        "拖拽文件上传",
        "实时上传和识别进度",
        "会话历史记录",
        "Markdown 结果预览",
        "一键复制到剪贴板",
        "保存为 Markdown 文件",
        "响应式设计（移动端友好）"
      ],
      "knownIssues": {
        "safariFileUpload": {
          "issue": "Safari 上传文件时 react-dropzone 返回的对象被转换为普通 JavaScript 对象，导致 File 方法丢失",
          "symptoms": "上传 15 字节，内容为 [object Object]",
          "rootCause": "使用扩展运算符 ...file 将 File 对象转换为普通对象，丢失了所有原型方法（arrayBuffer, slice 等）",
          "fix": "使用包装对象结构 {id, name, file} 保留原始 File 对象，避免使用扩展运算符 ...file",
          "affectedFiles": [
            "frontend/app/page.js - handleFilesAdded() 和 startRecognition()",
            "frontend/components/FileUpload.jsx - 文件列表渲染"
          ],
          "solutionCode": {
            "wrong": "const filesWithSize = validFiles.map(file => ({ ...file, name: file.name, size: file.size }));",
            "correct": "const filesWithSize = validFiles.map(file => ({ id: Math.random().toString(36).substr(2, 9), name: file.name, file }));"
          }
        }
      }
    },
    "backend": {
      "port": 8000,
      "framework": "FastAPI",
      "endpoints": {
        "/api/upload": "文件上传（支持 multipart/form-data 和原始二进制）",
        "/api/recognize": "OCR 识别",
        "/api/save": "保存结果为 Markdown",
        "/api/download/{filename}": "下载文件",
        "/api/logs": "日志管理"
      },
      "features": [
        "CORS 配置",
        "文件大小限制（10 MB）",
        "文件类型验证",
        "错误处理和友好提示"
      ]
    }
  },

  "openCodeConfig": {
    "_comment": "请复制下方的 'mcp' 块内容到 OpenCode 的配置文件中",
    "_instruction": "OpenCode 配置文件位置通常在: ~/Library/Application Support/OpenCode/User/settings.json (具体请以 OpenCode 实际文档为准)",
    "config": {
      "mcp": {
        "wrongmath": {
          "type": "local",
          "command": [
            "python3",
            "/Users/gubin/project/wrongmathf4/src/server.py"
          ],
          "enabled": true,
          "environment": {
            "SILICONFLOW_API_KEY": "sk-your-actual-api-key-here",
            "DEEPSEEK_OCR_MODEL": "deepseek-ai/DeepSeek-OCR",
            "SILICONFLOW_BASE_URL": "https://api.siliconflow.cn/v1",
            "LOG_LEVEL": "INFO"
          }
        }
      }
    }
  },

  "quickStart": {
    "steps": [
      "克隆项目: git clone https://github.com/uraul/wrongmathf4.git",
      "安装后端依赖: pip install -r requirements.txt",
      "安装前端依赖: cd frontend && npm install",
      "配置 API Key: export SILICONFLOW_API_KEY=sk-xxx",
      "Web UI 模式: 启动后端 python3 web.py (端口 8000)，启动前端 cd frontend && npm run dev (端口 3000)",
      "MCP 模式: 复制 openCodeConfig.config 到 OpenCode settings.json",
      "开始使用: 访问 http://localhost:3000 或在 OpenCode 中使用 MCP 工具"
    ]
  }
}
